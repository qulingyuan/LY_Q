## Chrome 最新架构



![chrome多进程](https://cdn.jsdelivr.net/gh/qulingyuan/ly_picture@master/img/202205141150203.webp)

最新的 Chrome 浏览器包括：1 个浏览器（Browser）主进程、1 个 GPU 进程、1 个网络（NetWork）进程、多个渲染进程和多个插件进程。

- **浏览器进程**：主要负责界面显示、用户交互、子进程管理，同时提供存储等功能。
- **渲染进程**：核心任务是将 HTML、CSS 和 JavaScript 转换为用户可以与之交互的网页，排版引擎 Blink 和 JavaScript 引擎 V8 都是运行在该进程中，默认情况下，Chrome 会为每个 Tab 标签创建一个渲染进程。出于安全考虑，渲染进程都是运行在沙箱模式下。
- **GPU 进程**：其实，Chrome 刚开始发布的时候是没有 GPU 进程的。而 GPU 的使用初衷是为了实现 3D CSS 的效果，只是随后网页、Chrome 的 UI 界面都选择采用 GPU 来绘制，这使得 GPU 成为浏览器普遍的需求。最后，Chrome 在其多进程架构上也引入了 GPU 进程。
- **网络进程**：主要负责页面的网络资源加载，之前是作为一个模块运行在浏览器进程里面的，直至最近才独立出来，成为一个单独的进程。
- **插件进程**：主要是负责插件的运行，因插件易崩溃，所以需要通过插件进程来隔离，以保证插件进程崩溃不会对浏览器和页面造成影响。

## 网络协议

#### ip

IP 通过 IP 地址信息把数据包发送给指定的电脑，而 UDP 通过端口号把数据包分发给正确的程序。

UDP 不能保证数据可靠性，但是传输速度却非常快，所以 UDP 会应用在一些关注速度、但不那么严格要求数据完整性的领域，如在线视频、互动游戏等。

TCP（Transmission Control Protocol，传输控制协议）是一种面向连接的、可靠的、基于字节流的传输层通信协议。

对于数据包丢失的情况，TCP 提供重传机制；TCP 引入了数据包排序机制，用来保证把乱序的数据包组合成一个完整的文件。

作为应用层协议，HTTP 的内容是通过 TCP 的传输数据阶段来实现的。

如果请求或响应头中添加了`Connection:Keep-Alive` 后，TCP 连接在发送后将仍然保持打开状态，保持 TCP 连接可以省去下次请求时需要建立连接的时间，提升资源加载速度。

响应状态码`301`、`302`分别为永久重定向、临时重定向。浏览器会跳转到响应数据中 `Location` 的地址。

301 表示旧地址 A 的资源已经被永久地移除了（这个资源不可访问了），搜索引擎在抓取新内容的同时也将旧的网址交换为重定向之后的网址； 302 表示旧地址 A 的资源还在（仍然可以访问），这个重定向只是临时地从旧地址 A 跳转到地址 B，搜索引擎会抓取新的内容而保存旧的网址。

**DNS 缓存**和**页面资源缓存**这两块数据是会被浏览器缓存的。

响应头中的 `Cache-Control` 字段来设置是否缓存该资源。

登录态如何保持？

服务器生成一段表示用户身份的字符串，写入相应头的 `Set-Cookie`字段中，被浏览器接受并保存在 `Cookie` 字段中。再次发起请求时，请求头会带上 `Cookie`字段。

将`cookie`设置了`httponly`属性后，就无法通过js脚本来读取了，只是在发送http请求时候会被带上。

拥有`相同的协议`和`根域名`的网页属于同一站点。

通常情况下，打开新的页面都会使用单独的渲染进程；

如果从 A 页面打开 B 页面，且 A 和 B 都属于同一站点的话，那么 B 页面复用 A 页面的渲染进程；如果是其他情况，浏览器进程则会为 B 创建一个新的渲染进程。

浏览器渲染流程：

1. 构建 DOM 树

浏览器无法直接理解和使用 HTML，所以需要将 HTML 转换为浏览器能够理解的结构——DOM 树。

2. 样式计算（Recalculate Style）

将 CSS 文本转换为浏览器可以理解的结构——`styleSheets`，计算出 DOM 树所有节点的样式。

3. 布局阶段

计算出 DOM 元素的布局信息，将其保存在布局树中。

减少重排重绘, 方法很多： 

1. 使用 class 操作样式，而不是频繁操作 style 
2. 2. 避免使用 table 布局 3. 批量dom 操作，例如 createDocumentFragment，或者使用框架，例如 React 4. Debounce window resize 事件 5. 对 dom 属性的读写要分离  6. will-change: transform 做优化